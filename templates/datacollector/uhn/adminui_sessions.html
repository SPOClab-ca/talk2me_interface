{% extends "datacollector/base.html" %}

{% block title %}{{ website_name }} - Admin Dashboard{% endblock%}

{% block auth_user %}
    {% if is_authenticated %}
        Logged in as {{ user.username }} (<a href="/{{ website_id }}/logout">logout</a>)
    {% else %}
        <a href="/{{ website_id }}/login">Login</a> | <a href="/{{ website_id }}/register">New User</a>
    {% endif %}
{% endblock %}

{% block content %}

<h1>Admin Dashboard</h1>

<ol class="breadcrumb">
  <li><a href="/{{ website_id }}/uhn">Index</a></li>
  <li><a href="/{{ website_id }}/uhn/admin">Admin Dashboard</a></li>
  <li><a href="/{{ website_id }}/uhn/admin/{{ bundle.name_id }}">{{ bundle.name_id }}</a></li>
  <li class="active">User {{ subject.user_id }}</li>
</ol>

<hr/>

<h2>Information for User {{ subject.user_id }}</h2>

<ul class="list-group">
    <li class="list-group-item">
        <b>Date consent submitted:</b> {{ subject.date_consent_submitted }}
    </li>
    <li class="list-group-item">
        <b>Last session accessed:</b> {{ subject.date_last_session_access }}
    </li>
    {% if bundle.name_id == 'uhn_phone' %}
    <li class="list-group-item">
        <b>Phone PIN:</b> {{ subject.phone_pin }}
    </li>
    {% endif %}
</ul>
<hr/>

<h3>Sessions</h3>

<table class="table">
    <thead>
        <tr>
            <th>Session ID</th>
            <th>Start date</th>
            <th>Date of completion</th>
        </tr>
    </thead>
{% for session in sessions %}
    
    <tr {% if session.end_date %} class="success" {% endif %} data-toggle="modal" data-target="#sessionModal">
    <div id="sessionModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-body">
                   {% for session_task in session.session_tasks %}
                    <div class="panel panel-default">
                        <div class="panel-heading">{{ session_task.task }}</div>
                        <ul class="list-group">
                            {% for task_instance in session_task.task_instances %}
                            <li class="list-group-item">
                                {{ task_instance }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                       {% endfor %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

        <td>{{ session.session_id }}</td>
        <td>{{ session.start_date }}</td>
        <td>{{ session.end_date }}</td>
    </tr>
{% endfor %}
</table>



{% endblock %}
